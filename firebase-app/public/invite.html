<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸƒâ€â™‚ï¸ Rejoindre le Dashboard Groupe Strava</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <h1 class="title">ğŸƒâ€â™‚ï¸ Dashboard Groupe Strava</h1>
        
        <p class="subtitle">
            Rejoins notre dashboard privÃ© pour voir nos stats comparÃ©es, 
            dÃ©fis hebdomadaires et suivre l'Ã©volution du groupe !
        </p>
        
        <div class="info-section">
            <h2 class="info-title">ğŸ¯ Ce qui t'attend :</h2>
            <div class="feature-list">
                <div class="feature">
                    <span class="feature-icon">ğŸ“Š</span>
                    <span>Stats comparÃ©es en temps rÃ©el</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">ğŸ†</span>
                    <span>Classements hebdomadaires du groupe</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">ğŸ¯</span>
                    <span>DÃ©fis et challenges entre amis</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">ğŸ“ˆ</span>
                    <span>Ã‰volution de tes performances</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">ğŸš´</span>
                    <span>DonnÃ©es vÃ©lo et course sÃ©parÃ©es</span>
                </div>
                <div class="feature">
                    <span class="feature-icon">ğŸ”’</span>
                    <span>100% privÃ©, visible du groupe seulement</span>
                </div>
            </div>
        </div>
        
        <button class="nav-btn btn-primary" onclick="connectStrava()" id="connectBtn">
            ğŸ”— Connecter mon Strava
        </button>
        
        <div class="loading" id="loading">â³</div>
        
        <div class="status" id="status"></div>
        
        <div class="footer">
            <p>ğŸ” Tes donnÃ©es Strava restent sÃ©curisÃ©es et ne sont partagÃ©es qu'avec notre groupe privÃ©.</p>
            <p>Tu peux rÃ©voquer l'accÃ¨s Ã  tout moment dans tes paramÃ¨tres Strava.</p>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script>
        function connectStrava() {
            // VÃ©rifier que la configuration est chargÃ©e
            if (typeof CONFIG === 'undefined') {
                showError('Configuration non chargÃ©e ! ProblÃ¨me avec config.js');
                return;
            }

            // VÃ©rifier que la configuration est valide
            const configErrors = validateConfig();
            if (configErrors.length > 0) {
                showError('Configuration incomplÃ¨te : ' + configErrors.join(', '));
                return;
            }

            const authUrl = getStravaAuthUrl();
            showLoading('Redirection vers Strava...');
            
            console.log('URL d\'autorisation:', authUrl);
            
            setTimeout(() => {
                window.location.href = authUrl;
            }, 1000);
        }

        function showLoading(message) {
            document.getElementById('connectBtn').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            showStatus(message, 'info');
        }

        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status status-${type}`;
            statusEl.style.display = 'block';
        }

        function showError(message) {
            showStatus(message, 'error');
            document.getElementById('connectBtn').style.display = 'inline-block';
            document.getElementById('loading').style.display = 'none';
        }

        // Log de debug au chargement
        window.addEventListener('load', function() {
            console.log('Page d\'invitation chargÃ©e');
            if (typeof CONFIG !== 'undefined') {
                console.log('Configuration:', CONFIG);
                
                // VÃ©rifier la config et afficher les erreurs Ã©ventuelles
                const errors = validateConfig();
                if (errors.length > 0) {
                    console.warn('Erreurs de configuration:', errors);
                    showError('Configuration incomplÃ¨te : ' + errors.join(', '));
                } else {
                    console.log('âœ… Configuration OK - PrÃªt pour l\'invitation !');
                }
            } else {
                console.error('âŒ CONFIG non dÃ©fini - ProblÃ¨me avec config.js');
                showError('Configuration non chargÃ©e ! VÃ©rifiez que js/config.js existe.');
            }
        });
    </script>
</body>
</html>